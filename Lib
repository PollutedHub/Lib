local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")

local Pollution = {}
Pollution.Accent = Color3.fromRGB(0, 255, 0)
Pollution.AccentTransparent = Color3.fromRGB(0, 255, 0)
Pollution.Windows = {}
Pollution.Values = {}
Pollution.Configs = {} -- store configs

--[[ Utility Functions ]]--
local function tweenObject(obj, props, duration, style, direction)
    style = style or Enum.EasingStyle.Quad
    direction = direction or Enum.EasingDirection.Out
    local tween = TweenService:Create(obj, TweenInfo.new(duration, style, direction), props)
    tween:Play()
    return tween
end

local function createUICorner(parent, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius or 4)
    corner.Parent = parent
    return corner
end

--[[ Create Main Screen ]]--
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Global
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game:GetService("CoreGui")

-- Modal Overlay for popups
local ModalOverlay = Instance.new("TextButton")
ModalOverlay.Name = "ModalOverlay"
ModalOverlay.BackgroundTransparency = 1
ModalOverlay.Text = ""
ModalOverlay.AutoButtonColor = false
ModalOverlay.Visible = false
ModalOverlay.Size = UDim2.fromScale(1,1)
ModalOverlay.Position = UDim2.fromOffset(0,0)
ModalOverlay.ZIndex = 999
ModalOverlay.Parent = ScreenGui

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
MainFrame.Size = UDim2.new(0, 720, 0, 550)
MainFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
MainFrame.BorderSizePixel = 0
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
createUICorner(MainFrame, 6)

-- Container
local Container = Instance.new("Frame")
Container.Size = UDim2.new(0, 678, 0, 505)
Container.Position = UDim2.new(0.02, 0, 0.05, 0)
Container.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Container.BorderSizePixel = 0
Container.Name = "Container"
Container.Parent = MainFrame
createUICorner(Container, 6)

-- Top Bar
local TopBar = Instance.new("Frame")
TopBar.Size = UDim2.new(0, 660, 0, 65)
TopBar.Position = UDim2.new(0.04, 0, 0.07, 0)
TopBar.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
TopBar.BorderSizePixel = 0
TopBar.Name = "TopBar"
TopBar.Parent = MainFrame
createUICorner(TopBar, 4)

-- Library Title
local LibName = Instance.new("TextLabel")
LibName.Text = "POLLUTION"
LibName.TextColor3 = Color3.fromRGB(0, 255, 0)
LibName.BackgroundTransparency = 1
LibName.Position = UDim2.new(0.04, 10, 0.4, 0)
LibName.Size = UDim2.new(0, 1, 0, 1)
LibName.AutomaticSize = Enum.AutomaticSize.XY
LibName.TextSize = 21
LibName.Font = Enum.Font.GothamSemibold
LibName.Parent = TopBar

-- Header for Tabs
local Header = Instance.new("Frame")
Header.AnchorPoint = Vector2.new(1,0.5)
Header.Position = UDim2.new(1,0,0.5,0)
Header.Size = UDim2.new(0, 508, 0, 65)
Header.BackgroundTransparency = 1
Header.Name = "Header"
Header.Parent = TopBar

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.FillDirection = Enum.FillDirection.Horizontal
UIListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Right
UIListLayout.Padding = UDim.new(0,2)
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Parent = Header

local UIPadding = Instance.new("UIPadding")
UIPadding.PaddingTop = UDim.new(0,10)
UIPadding.PaddingRight = UDim.new(0,20)
UIPadding.Parent = Header

--[[ Library Functions ]]--
function Pollution:CreateWindow(name)
    local window = {}
    window.Name = name
    window.Tabs = {}
    Pollution.Windows[name] = window

    -- Create tab container
    window.TabContainer = Instance.new("Frame")
    window.TabContainer.BackgroundTransparency = 1
    window.TabContainer.Size = UDim2.new(1,0,1,0)
    window.TabContainer.Position = UDim2.new(0,0,0,0)
    window.TabContainer.Parent = Container

    function window:CreateTab(tabName)
        local tab = {}
        tab.Name = tabName
        tab.Sections = {left = {}, right = {}}

        -- Tab Button in Header
        local btn = Instance.new("TextButton")
        btn.Text = tabName
        btn.BackgroundTransparency = 1
        btn.TextColor3 = Color3.fromRGB(0, 255, 0)
        btn.Size = UDim2.new(0,100,0,35)
        btn.Parent = Header

        btn.MouseButton1Click:Connect(function()
            -- Show/Hide tab contents
            for _, otherTab in pairs(window.Tabs) do
                if otherTab.Frame then otherTab.Frame.Visible = false end
            end
            tab.Frame.Visible = true
        end)

        -- Frame for tab content
        local tabFrame = Instance.new("Frame")
        tabFrame.Size = UDim2.new(1,0,1,0)
        tabFrame.BackgroundTransparency = 1
        tabFrame.Visible = false
        tabFrame.Parent = window.TabContainer
        tab.Frame = tabFrame

        function tab:AddSection(side, name)
            local section = Instance.new("Frame")
            section.Size = UDim2.new(0.48,0,0.95,0)
            section.Position = side == "left" and UDim2.new(0,0,0,0) or UDim2.new(0.52,0,0,0)
            section.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
            section.Parent = tabFrame
            createUICorner(section,4)

            local label = Instance.new("TextLabel")
            label.Text = name
            label.Size = UDim2.new(1,0,0,25)
            label.TextColor3 = Color3.fromRGB(0,255,0)
            label.BackgroundTransparency = 1
            label.Font = Enum.Font.GothamBold
            label.TextSize = 16
            label.Parent = section

            table.insert(tab.Sections[side], section)
            return section
        end

        table.insert(window.Tabs, tab)
        return tab
    end

    -- Automatically create Save Manager tab
    local saveTab = window:CreateTab("Save Manager")

    -- Save Manager Section
    local saveSection = saveTab:AddSection("left", "Config Manager")

    -- Add Save Button
    local saveButton = Instance.new("TextButton")
    saveButton.Text = "Save Config"
    saveButton.Size = UDim2.new(1,0,0,30)
    saveButton.BackgroundColor3 = Pollution.Accent
    saveButton.TextColor3 = Color3.fromRGB(0,0,0)
    saveButton.Parent = saveSection

    saveButton.MouseButton1Click:Connect(function()
        Pollution.Configs[window.Name] = Pollution.Values
        print("Configuration saved!")
    end)

    -- Add Load Button
    local loadButton = Instance.new("TextButton")
    loadButton.Text = "Load Config"
    loadButton.Size = UDim2.new(1,0,0,30)
    loadButton.Position = UDim2.new(0,0,0,35)
    loadButton.BackgroundColor3 = Pollution.Accent
    loadButton.TextColor3 = Color3.fromRGB(0,0,0)
    loadButton.Parent = saveSection

    loadButton.MouseButton1Click:Connect(function()
        if Pollution.Configs[window.Name] then
            Pollution.Values = Pollution.Configs[window.Name]
            print("Configuration loaded!")
        end
    end)

    return window
end

return Pollution
