local Pollution = {}
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- Theme
Pollution.Theme = {
	BG = Color3.fromRGB(18,18,18),
	Panel = Color3.fromRGB(28,28,28),
	Sidebar = Color3.fromRGB(30,30,30),
	Accent = Color3.fromRGB(200,160,120),
	Secondary = Color3.fromRGB(40,40,40),
	Text = Color3.fromRGB(240,240,240),
	Footer = Color3.fromRGB(22,22,22)
}

-- utility: new instance
local function new(class, props)
	local obj = Instance.new(class)
	for k,v in pairs(props or {}) do
		if k == "Parent" then obj.Parent = v else obj[k] = v end
	end
	return obj
end

-- simple tween
local function tween(obj, props, time)
	time = time or 0.16
	TweenService:Create(obj, TweenInfo.new(time, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), props):Play()
end

-- draggable
function Pollution.MakeDraggable(frame, handle)
	handle.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			local startMouse = input.Position
			local startPos = frame.Position
			local conn
			conn = UserInputService.InputChanged:Connect(function(move)
				if move.UserInputType == Enum.UserInputType.MouseMovement then
					local delta = move.Position - startMouse
					frame.Position = UDim2.new(
						math.clamp(startPos.X.Scale,0,1), startPos.X.Offset+delta.X,
						math.clamp(startPos.Y.Scale,0,1), startPos.Y.Offset+delta.Y
					)
				end
			end)
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					conn:Disconnect()
				end
			end)
		end
	end)
end

-- Create main window
function Pollution.CreateWindow(opts)
	opts = opts or {}
	local screenGui = new("ScreenGui", {
		Name = opts.Name or "PollutionUI",
		ResetOnSpawn = false,
		IgnoreGuiInset = true,
		Parent = player:WaitForChild("PlayerGui")
	})

	local main = new("Frame", {
		Name = "Main",
		Parent = screenGui,
		Size = opts.Size or UDim2.new(0,760,0,500),
		Position = opts.Position or UDim2.new(0.5,0,0.5,0),
		AnchorPoint = Vector2.new(0.5,0.5),
		BackgroundColor3 = Pollution.Theme.BG,
		BorderSizePixel = 0,
		ClipsDescendants = true
	})
	new("UICorner",{Parent=main, CornerRadius=UDim.new(0,8)})

	-- top bar
	local top = new("Frame",{Parent=main, Name="Top", Size=UDim2.new(1,0,0,36), BackgroundColor3=Color3.fromRGB(24,24,24), BorderSizePixel=0})
	new("UICorner",{Parent=top, CornerRadius=UDim.new(0,6)})
	local title = new("TextLabel",{Parent=top, Text=opts.Title or "Pollution UI", Font=Enum.Font.GothamBold, TextColor3=Pollution.Theme.Accent, TextSize=14, BackgroundTransparency=1, Position=UDim2.new(0,10,0,0), Size=UDim2.new(0,260,1,0), TextXAlignment=Enum.TextXAlignment.Left})

	-- sidebar
	local sidebar = new("Frame",{Parent=main, Name="Sidebar", Size=UDim2.new(0,150,1,-36), Position=UDim2.new(0,0,0,36), BackgroundColor3=Pollution.Theme.Sidebar, BorderSizePixel=0})
	new("UICorner",{Parent=sidebar, CornerRadius=UDim.new(0,6)})

	-- content area
	local content = new("Frame",{Parent=main, Name="Content", Size=UDim2.new(1,-150,1,-36-24), Position=UDim2.new(0,150,0,36), BackgroundColor3=Pollution.Theme.Panel, BorderSizePixel=0})
	new("UICorner",{Parent=content, CornerRadius=UDim.new(0,8)})

	-- footer
	local footer = new("Frame",{Parent=main, Name="Footer", Size=UDim2.new(1,-150,0,24), Position=UDim2.new(0,150,1,-24), BackgroundColor3=Pollution.Theme.Footer, BorderSizePixel=0})
	new("UICorner",{Parent=footer, CornerRadius=UDim.new(0,6)})
	local footerLabel = new("TextLabel",{Parent=footer, Text=opts.FooterText or "Pollution UI | v1.0", Font=Enum.Font.Gotham, TextColor3=Pollution.Theme.Text, TextSize=12, BackgroundTransparency=1, Position=UDim2.new(0,8,0,0), Size=UDim2.new(1,-16,1,0), TextXAlignment=Enum.TextXAlignment.Left})

	-- resize handle
	local resize = new("Frame",{Parent=main, Name="Resize", Size=UDim2.new(0,18,0,18), AnchorPoint=Vector2.new(1,1), Position=UDim2.new(1,0,1,0), BackgroundColor3=Color3.fromRGB(45,40,35), BorderSizePixel=0})
	new("UICorner",{Parent=resize, CornerRadius=UDim.new(0,4)})
	do
		local dragging = false
		local startPos, startSize
		resize.InputBegan:Connect(function(input)
			if input.UserInputType==Enum.UserInputType.MouseButton1 then
				dragging = true
				startPos = input.Position
				startSize = main.Size
				input.Changed:Connect(function()
					if input.UserInputState==Enum.UserInputState.End then dragging=false end
				end)
			end
		end)
		UserInputService.InputChanged:Connect(function(input)
			if dragging and input.UserInputType==Enum.UserInputType.MouseMovement then
				local delta = input.Position - startPos
				local newW = math.clamp(startSize.X.Offset + delta.X, 420, 1400)
				local newH = math.clamp(startSize.Y.Offset + delta.Y, 260, 1000)
				main.Size = UDim2.new(0,newW,0,newH)
				footer.Size = UDim2.new(1,-150,0,24)
				footer.Position = UDim2.new(0,150,1,-24)
			end
		end)
	end

	Pollution.MakeDraggable(main, top)

	-- API
	local api = {ScreenGui=screenGui, Main=main, Top=top, Title=title, Sidebar=sidebar, Content=content, Footer=footer, FooterLabel=footerLabel}
	return api
end

-- GroupBox
function Pollution.CreateGroupBox(parent, title)
	local gb = new("Frame",{Parent=parent, Size=UDim2.new(1,0,0,120), BackgroundColor3=Pollution.Theme.Panel, BorderSizePixel=0})
	new("UICorner",{Parent=gb, CornerRadius=UDim.new(0,6)})
	local header = new("TextLabel",{Parent=gb, Text=title or "Group", Font=Enum.Font.GothamSemibold, TextColor3=Pollution.Theme.Accent, TextSize=14, BackgroundTransparency=1, Position=UDim2.new(0,8,0,6), Size=UDim2.new(1,-16,0,20), TextXAlignment=Enum.TextXAlignment.Left})
	local body = new("Frame",{Parent=gb, Size=UDim2.new(1,-12,1,-36), Position=UDim2.new(0,6,0,32), BackgroundTransparency=1})
	local layout = new("UIListLayout",{Parent=body, Padding=UDim.new(0,8), SortOrder=Enum.SortOrder.LayoutOrder})
	return {Frame=gb, Header=header, Body=body}
end

return Pollution
